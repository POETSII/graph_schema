<?xml version="1.0" ?>
<Graphs xmlns="https://poets-project.org/schemas/virtual-graph-schema-v4">
  <GraphType id="test_supervisor_1dev_to_sup_bcast_gt">
    <SharedCode />

    <Properties/>
    <MessageTypes>
      <MessageType id="bump">
        <Message><![CDATA[
        uint32_t t;
        ]]></Message>
      </MessageType>
    </MessageTypes>

    <DeviceTypes>
      <DeviceType id="dev">
        <SharedCode />
        <Properties />
        <State>
            <![CDATA[
            uint32_t todo;
            uint32_t waiting;
            ]]>
        </State>

        <SupervisorInPin messageTypeId="bump">
          <OnReceive><![CDATA[
          assert(deviceState->waiting);
            deviceState->todo -= 1;
            deviceState->waiting = 0;
          ]]></OnReceive>
        </SupervisorInPin>
        <SupervisorOutPin messageTypeId="bump">
          <OnSend><![CDATA[
            deviceState->waiting = 1;
          ]]></OnSend>
        </SupervisorOutPin>
        <ReadyToSend><![CDATA[
        *readyToSend=0;
        if(deviceState->todo && !deviceState->waiting ){
          *readyToSend |= RTS_SUPER_IMPLICIT_SEND_FLAG;
        }
        ]]></ReadyToSend>
        <OnInit>
        <![CDATA[
        deviceState->todo=100;
        deviceState->waiting = 0;
        ]]></OnInit>

        <OnHardwareIdle/>
        <OnDeviceIdle/>
      </DeviceType>

      <SupervisorType id="sup">
        <Code />
        <Properties />
        <State><![CDATA[
        uint32_t seen;
        ]]></State>
        <OnInit><![CDATA[
          Super::post("SupervisorType::OnInit");
          supervisorState->seen=0;
        ]]></OnInit>
        <SupervisorInPin id="" messageTypeId="pulse">
          <OnReceive><![CDATA[
          Super::post("SupervisorType::OnReceive");
          supervisorState->seen += 1;

          RTSBCAST();

          if(supervisorState->seen==100){
            Super::post("_HANDLER_EXIT_SUCCESS_9be65737_");
            Super::stop_application();
          }
          ]]></OnReceive>
        </SupervisorInPin>
        <OnStop><![CDATA[
        ]]></OnStop>
      </SupervisorType>
    </DeviceTypes>
  </GraphType>
  <GraphInstance id="test_supervisor_1dev_to_sup_bcast_gi" graphTypeId="test_supervisor_1dev_to_sup_bcast_gt" P="{}">
    <DeviceInstances>
      <DevI id="d0" type="dev" />
    </DeviceInstances>
    <EdgeInstances>
    </EdgeInstances>
  </GraphInstance>
</Graphs>
