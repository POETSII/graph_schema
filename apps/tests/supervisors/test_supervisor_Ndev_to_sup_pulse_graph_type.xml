<?xml version="1.0" ?>
<Graphs xmlns="https://poets-project.org/schemas/virtual-graph-schema-v4">
  <GraphType id="test_supervisor_Ndev_to_sup_pulse_gt">
    <SharedCode />

    <Properties>
      <![CDATA[
      uint32_t n;
      uint32_t reps;
      ]]>
    </Properties>
    <MessageTypes>
      <MessageType id="pulse">
        <Message><![CDATA[
        ]]></Message>
      </MessageType>
    </MessageTypes>

    <DeviceTypes>
      <DeviceType id="dev">
        <SharedCode />
        <Properties />
        <State>
            <![CDATA[
            uint32_t todo;
            ]]>
        </State>

        <SupervisorOutPin messageTypeId="pulse">
          <OnSend><![CDATA[
            deviceState->todo -= 1;
          ]]></OnSend>
        </SupervisorOutPin>
        <ReadyToSend><![CDATA[
        *readyToSend=0;
        if(deviceState->todo){
          *readyToSend |= RTS_SUPER_IMPLICIT_SEND_FLAG;
        }
        ]]></ReadyToSend>
        <OnInit>
        <![CDATA[
        deviceState->todo=graphProperties->reps;
        ]]></OnInit>

        <OnHardwareIdle/>
        <OnDeviceIdle/>
      </DeviceType>

      <SupervisorType id="sup">
        <Code />
        <Properties />
        <State><![CDATA[
        uint32_t seen;
        ]]></State>
        <OnInit><![CDATA[
          Super::post("SupervisorType::OnInit");
          supervisorState->seen = 0;
        ]]></OnInit>
        <SupervisorInPin id="" messageTypeId="pulse">
          <OnReceive><![CDATA[
          //Super::post("SupervisorType::OnReceive " + std::to_string(supervisorState->seen));
          supervisorState->seen += 1;
          uint32_t target=graphProperties->n * graphProperties->reps;
          if(supervisorState->seen==target){
            Super::post("_HANDLER_EXIT_SUCCESS_9be65737_");
            Super::stop_application();
          }
          ]]></OnReceive>
        </SupervisorInPin>
        <OnStop><![CDATA[
        ]]></OnStop>
      </SupervisorType>
    </DeviceTypes>
  </GraphType>
</Graphs>
